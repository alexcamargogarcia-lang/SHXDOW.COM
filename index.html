<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Chat con Gemini 2.5 Flash (funcionando 2026)</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 2rem auto; padding: 1rem; }
    #chat { border: 1px solid #ddd; padding: 1rem; height: 400px; overflow-y: auto; margin-bottom: 1rem; background: #f9f9f9; border-radius: 8px; }
    .user { text-align: right; color: #1e88e5; margin: 0.5rem 0; }
    .bot  { text-align: left; color: #2e7d32; margin: 0.5rem 0; }
    .error { color: red; font-weight: bold; }
    input  { width: 70%; padding: 0.8rem; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 0.8rem 1.5rem; background: #1e88e5; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #1565c0; }
  </style>
</head>
<body>

<h1>Chat IA potente con Gemini 2.5 Flash</h1>
<div id="chat"></div>

<input id="input" placeholder="Escribe tu mensaje aquí..." autofocus />
<button onclick="enviar()">Enviar</button>

<script type="module">
  import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

  // Tu API key (crea una nueva si sigue fallando: https://aistudio.google.com/app/apikey)
  const API_KEY = "AIzaSyAZYkYJBYRN7-4JwB03PQgyVelILiT4QRY";

  const genAI = new GoogleGenerativeAI(API_KEY);

  // Modelos válidos ahora (elige uno – empieza con gemini-2.5-flash)
  const model = genAI.getGenerativeModel({
    model: "gemini-2.5-flash",                // ← Este debería funcionar YA (estable, rápido)
    // model: "gemini-2.5-pro",               // Más inteligente (prueba si el anterior falla)
    // model: "gemini-3-flash-preview",       // El más nuevo, pero preview → necesita billing
    // model: "gemini-3-pro-preview",         // Top potencia, preview + billing
    generationConfig: { 
      temperature: 0.7, 
      maxOutputTokens: 1024 
    },
    systemInstruction: "Eres un asistente útil, preciso y amigable. Responde SIEMPRE en español."
  });

  const chat = model.startChat({ history: [] });

  const chatDiv = document.getElementById("chat");
  const input   = document.getElementById("input");

  function addMessage(texto, clase) {
    const div = document.createElement("div");
    div.className = clase;
    div.textContent = texto;
    chatDiv.appendChild(div);
    chatDiv.scrollTop = chatDiv.scrollHeight;
  }

  async function enviar() {
    const texto = input.value.trim();
    if (!texto) return;

    addMessage(texto, "user");
    input.value = "";

    try {
      addMessage("Pensando...", "bot");
      const result = await chat.sendMessage(texto);
      const respuesta = await result.response.text();

      chatDiv.lastChild.remove(); // Borra "Pensando..."
      addMessage(respuesta, "bot");
    } catch (err) {
      chatDiv.lastChild?.remove();
      let msgError = "Error: " + err.message;
      if (err.message.includes("404") || err.message.includes("not found")) {
        msgError += "\n\nModelo no disponible → Prueba cambiar a 'gemini-2.5-pro' o 'gemini-3-flash-preview' en el código.";
      }
      if (err.message.includes("API_KEY") || err.message.includes("invalid")) {
        msgError += "\n\nAPI Key inválida → Crea una nueva en https://aistudio.google.com/app/apikey";
      }
      if (err.message.includes("quota") || err.message.includes("limit")) {
        msgError += "\n\nLímite alcanzado → Espera o activa billing en Google Cloud.";
      }
      addMessage(msgError + "\n\nRevisa consola (F12 → Console) y dime el error exacto.", "bot error");
      console.error("Error Gemini:", err);
    }
  }

  input.addEventListener("keypress", e => {
    if (e.key === "Enter") enviar();
  });
</script>
</body>
</html>
